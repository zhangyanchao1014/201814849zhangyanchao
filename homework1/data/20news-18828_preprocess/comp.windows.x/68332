iopserver2iienckuedutw subject program wmprotocol open look toolkit hi studying book unix desktop guide open look example winpropc demonstrate program wmprotocol property chapter 8 run show static text message notice popup problem thank advance help1 iop file winpropc show set property window include x11xatomh definition xaatom include x11intrinsich include x11stringdefsh include xolopenlookh include xolstatictexth include xoloblongbutth include xolnoticeh thi file define atom ol prefix id toplevel noticeshell widget static widget toplevel noticeshell static widget makenotice static char message client use property communicate window manager thi example illustrate open look application request notification window manager certain event occur communication form clientmessage event application process eventhandler atom used interclient communication atom atomwmprotocol atomwmdeletewindow atomwmsaveyourself static void handlewmmessage static void saveandexit static void saveyourself static void popnotice static void doexit string hold comand line use responding wmsaveyourself protocol message char savedcmdline128 void mainargc argv int argc char argv widget w int save commandline use responding wmsaveyourself protocol message sprintfsavedcmdline argv0 ifargc 1 forus 1 argc strcatsavedcmdline argvus strcatsavedcmdline create initialize toplevel widget toplevel olinitializeargv0 olmain null 0 argc argv create statictext widget w xtvacreatemanagedwidgetstext statictextwidgetclas toplevel xtnstring message xtnwidth 200 null create noticeshell widget later use makenoticetoplevel intern atom atomwmprotocol xinternatomxtdisplayw wmprotocol false atomwmdeletewindow xinternatomxtdisplayw wmdeletewindow false atomwmsaveyourself xinternatomxtdisplayw wmsaveyourself false add eventhandler proces clientmessage event sent window manager xtaddeventhandlertoplevel noeventmask true handlewmmessage null realize widget start processing event xtrealizewidgettoplevel append property wmdeletewindow wmsaveyourself definition wmprotocol property thi step require window id toplevel widget window id valid widget realized xchangepropertyxtdisplaytoplevel xtwindowtoplevel atomwmprotocol xaatom 32 propmodeappend atomwmdeletewindow 1 xchangepropertyxtdisplaytoplevel xtwindowtoplevel atomwmprotocol xaatom 32 propmodeappend atomwmsaveyourself 1 xtmainloop static void handlewmmessagesw clientdatum pevent widget w xtpointer clientdatum xevent pevent ifpeventtype clientmessage peventxclientmessagetype atomwmprotocol ifpeventxclientdatal0 atomwmdeletewindow saveandexit ifpeventxclientdatal0 atomwmsaveyourself saveyourself static void saveandexit display notice giving user chance respond popnoticetoplevel noticeshell static void saveyourself set wmcommand property saved commandline xchangepropertyxtdisplaytoplevel xtwindowtoplevel xawmcommand xastring 8 propmodereplace savedcmdline strlensavedcmdline 1 static widget makenoticeparent widget parent widget w ntext ncontrol nexit ncancel create button provide callback pop notice w xtvacreatemanagedwidgetquitbutton oblongbuttonwidgetclas parent xtnlabel exit null xtaddcallbackw xtnselect popnotice null create noticeshell widget note use xtvacreatepopupshell instead usual xtvacreatemanagedwidget noticeshell xtvacreatepopupshellquitnotice noticeshellwidgetclas w null get id text control area widget noticeshell xtvagetvaluesnoticeshell xtntextarea ntext xtncontrolarea ncontrol null place message text area noticeshell xtvasetvaluesntext xtnstring please confirm exit program null add button control area noticeshell button ha appropriate callback nexit xtvacreatemanagedwidgetnoticeexit oblongbuttonwidgetclas ncontrol xtnlabel exit null xtaddcallbacknexit xtnselect doexit null ncancel xtvacreatemanagedwidgetnoticecancel oblongbuttonwidgetclas ncontrol xtnlabel cancel xtndefault true null return w static void popnoticewemanate wnotice widget wemanate wnotice xtvasetvalueswnotice xtnemanatewidget wemanate null pop noticeshell widget noticeshell widget make sure aplication wait user select one button noticeshell control area xtpopupwnotice xtgrabexclusive static void doexitw calldatum clientdatum widget w xtpointer calldatum clientdatum xclosedisplayxtdisplayw exit0